<html><meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0><style>canvas{width:100%;height:100%;}body{margin:0;background:#000;}</style><canvas><script>const canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d");var w,h;function width(){return w}function height(){return h}function resize(){canvas.width=+window.innerWidth,canvas.height=+window.innerHeight,w=canvas.width,h=canvas.height}ctx.imageSmoothingEnabled=!0,resize(),window.addEventListener("resize",resize);var g=[];function get(){return g}function add(e){g.push(e)}function remove(t){g=g.filter(e=>e!=t)}function clear(e){g=[]}function pulse(t,l,i,a){var n=0;return e=>{n+=e,t((Math.sin(n/a*6.3)+1)/2*(i-l)+l)}}function e(){var l={};return{clear:()=>l={},on:(e,t)=>(l[e]||(l[e]=[])).push(t),off:(e,t)=>l[e]=(l[e]||[]).filter(e=>e!=t),emit:(e,t)=>(l[e]||[]).forEach(e=>e(t))}}b=new e;var bus=b;function Text(e,t,l,i="#fff",a="2",n="left"){this.str=e,this.x=t,this.y=l,this.color=i,this.size=a,this.render=e=>{e.textAlign=n,e.textBaseline="middle",e.fillStyle=this.color,e.font=`${this.size}em monospace`,e.fillText(this.str,this.x(),this.y())}}function drawStars(t,l,i,a,n){var r=width(),o=height(),s=Math.sqrt(r*o)/10;t.beginPath(),t.strokeStyle="#aaa",t.fillStyle="#ddd",t.lineWidth=.5;for(let e=0;e<s;e++){var f=1+5*(.5*Math.sin(e*e*1217+e*e*e*983)+.5),h=(1234918*e*e+e*e*e*e*2291722+l*f)%r,c=(3000182*e*e*e*e+e*e*e*e*e*500291+i*f)%o;t.moveTo(h,c),t.lineTo(h+a*f,c+n*f),t.fillRect(h-1,c-1,2,2)}t.stroke()}function drawCard(t,e,l,i,a,n,r){t.save(),n&&(i*=1.04);var o=`rgba(${a.color[0]},${a.color[1]},${a.color[2]},${r})`,s=i/2,f=1.5*s;t.translate(e,l),t.fillStyle=n?`rgb(80,80,80,${.7*r})`:`rgb(50,50,50,${.7*r})`,t.fillRect(-s,-f,2*s,2*f),t.save(),t.beginPath(),t.rect(-s,-f,2*s,2*f),t.clip(),t.fillStyle=`rgba(220,230,250,${.3*r})`,t.rotate(-.3),t.translate(i/2,Date.now()%2e3/1e3*(5*i)-1.2*i),t.fillRect(2*-i,0,4*i,.2*i),t.fillRect(2*-i,.2*-i,4*i,.05*i),t.restore(),t.beginPath(),t.lineWidth=i/20,t.lineJoin="round",t.strokeStyle=o,t.moveTo(-s,-f),t.lineTo(s,-f),t.lineTo(s,f),t.lineTo(-s,f),t.closePath(),t.stroke(),t.save(),t.translate(0,.15*-i),a.glyph(t,i),t.translate(0,.52*-i),t.fillStyle=`rgba(255,255,51,${r})`;var h=.12*i;for(let e=0;e<a.cost;e++)t.fillRect((e-(a.cost-1)/2)*h-.45*h,0,.9*h,.9*h);t.restore(),t.fillStyle=o,t.textBaseline="middle",t.font=`${i/6}px monospace`,t.textAlign="center";var c=a.title;for(let e=0;e<c.length;e++)t.fillText(c[e],0,.65*f+(e-(c.length-1)/2)*f*.2);t.restore()}const cards=[{color:[255,51,51],title:["Rho","Channel"],cost:1,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/4,0,6.29),e.stroke(),e.restore()},use:()=>{bus.emit("lane",0)}},{color:[51,255,51],title:["Gamma","Sector"],cost:1,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/4,0,6.29),e.stroke(),e.restore()},use:()=>{bus.emit("lane",1)}},{color:[51,51,255],title:["Beta","Stream"],cost:1,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/4,0,6.29),e.stroke(),e.restore()},use:()=>{bus.emit("lane",2)}}];function PlayedCard(t,l,i,a){var n=0;this.update=e=>{l-=500*(.5-n)*e,a+=3*a*(.5-n)*e,.5<(n+=1.2*e)&&(this.destroyed=!0)},this.render=e=>{drawCard(e,t,l,a,i,!1,2*(.5-n))}}function PullCard(l,i,a,n,t){var r=-2;this.update=e=>{1<(r+=3*e)&&(this.destroyed=!0,bus.emit("place",{slot:t,card:a}))},this.render=e=>{var t=Math.min(Math.max(r,0),1);drawCard(e,l*t*t+width()/2*(1-t*t),i*t*t+height()*(1-t*t),n*t,a,!1,t)}}function Asteroid(l,i,a){this.update=e=>{l.getTick()>i+6&&(this.destroyed=!0)},this.render=e=>{e.save(),e.translate(l.laneX(i),l.laneY(a));var t=+l.laneScale();e.fillStyle="#a55",e.beginPath(),e.arc(0,0,t,0,6.29),e.fill(),e.restore()}}function Engine(){var e=e=>Object.assign({},e),n=e=>e.sort(()=>Math.random()-.5),a=e=>{var t=parseInt(Math.random()*r.length),l=r[t];r.splice(t,1);var i=width(),a=height(),t=m(i,a);add(new PullCard(p(e,t,i),b(a),l,t,e)),0==r.length&&(n(r=o),o=[])},m=(e,t)=>Math.min(e*(.95/(1+i)),.185*t),p=(e,t,l)=>.5*l+(e-(i-1)/2)*t*1.17,b=e=>.735*e,r=[e(cards[0]),e(cards[0]),e(cards[0]),e(cards[1]),e(cards[1]),e(cards[1]),e(cards[2]),e(cards[2]),e(cards[2])],o=[];n(r);var i=3,w=[];for(let e=0;e<i;e++)a(e);var S=-1,t=1,x=1,T=0,P=6,R=0,M=0,E=0,$=0;const s=e=>{var t=width(),l=height(),i=e.x,a=e.y,n=-1,r=w.length,o=Math.min(t*(.95/(1+r)),.185*l);for(let e=0;e<r;e++){var s=.5*t+(e-(r-1)/2)*o*1.17,f=.735*l;s-o/2<i&&i<s+o/2&&f-3*o/4<a&&a<f+3*o/4&&(n=e)}return n};bus.on("tap",e=>{var t,l,i=s(e);0<=i&&null!=w[i]&&(cost=w[i].cost,P>=cost&&(P-=cost,w[i].use(),t=width(),l=height(),e=m(t,l),add(new PlayedCard(p(i,e,t),b(l),w[i],e)),e=i,o.push(w[e]),w[e]=null,a(i)))}),bus.on("move",e=>{S=s(e)}),bus.on("lane",e=>{t=e}),bus.on("place",({slot:e,card:t})=>{w[e]=t});var l=()=>{.07<Math.random()&&add(new Asteroid(this,M,parseInt(3*Math.random())))};this.laneY=e=>{var t=height();return 0==e?.18*t:1==e?.34*t:.5*t},this.laneX=e=>{var t=width(),l=50+t/40+this.laneScale();return l+(1-(M+E-e)/5)*(t+l)},this.laneScale=()=>{var e=width(),t=height();return.3*Math.min(.16*t,e/8)},this.getTick=()=>M,this.update=e=>{$+=e,1<(E+=2*e)&&(E--,M++,l()),P<6?1<=(R+=.75*e)&&(--R,P++):R=0,T+=7*(.5*(t-x)-T)*e,x+=5*(t-x)*e},this.render=t=>{var l=width(),i=height(),a=l/40,e=.16*i,n=.1*i,r=n+e,o=r+e,s=.3*Math.min(e,l/8);drawStars(t,20*-$,0,3,0);var f=n/2*.7;t.fillStyle="#446",t.fillRect(15+a,n/2,l-30-2*a,1),t.fillStyle="#446",t.beginPath(),t.arc(15+f,n/2,f,0,6.28),t.fill(),t.fillStyle="#446",t.beginPath(),t.arc(l-15-f,n/2,f,0,6.28),t.fill(),t.fillStyle="#fff";f=15+a+(M+E)/100*(l-30-2*a);t.beginPath(),t.moveTo(f+a/3,n/2),t.lineTo(f-a/3,n/2-a/3),t.lineTo(f-a/3,n/2+a/3),t.closePath(),t.fill(),t.fillStyle="#f33",t.fillRect(15,n,a,e),t.fillStyle="#3f3",t.fillRect(15,r,a,e),t.fillStyle="#33f",t.fillRect(15,o,a,e),t.fillStyle="#311",t.fillRect(l-15,n,-a,e),t.fillStyle="#131",t.fillRect(l-15,r,-a,e),t.fillStyle="#113",t.fillRect(l-15,o,-a,e),t.fillStyle="#222",t.fillRect(15,n,l-30,1),t.fillRect(15,r,l-30,1),t.fillRect(15,o,l-30,1),t.fillRect(15,o+e,l-30,1),t.save(),t.translate(50+a+s,n+e/2+x*e),t.rotate(T);for(let e=5;0<=e;e--){e<1?t.fillStyle="#fd6":e<3?t.fillStyle="#fa1":t.fillStyle="#a41",t.beginPath();var h=.2*Math.sin($*(e+1)*20)+.5;t.arc(-s-s*e*.1,Math.sin(40*-$+e)*e*s/30,s*h/(1.5+.3*e),0,6.29),t.fill()}t.translate(Math.sin(30*$)*s/60,Math.sin(35*$)*s/40),t.fillStyle="#fff",t.beginPath(),t.moveTo(s,0),t.lineTo(.65*-s,.8*-s),t.lineTo(.65*-s,.3*-s),t.lineTo(-s,.5*-s),t.lineTo(-s,.5*s),t.lineTo(.65*-s,.3*s),t.lineTo(.65*-s,.8*s),t.closePath(),t.fill(),t.fillRect(.4*-s,.4*s,s,.15*s),t.fillRect(.4*-s,.4*-s,s,.15*-s),t.restore();var n=Math.max(.025*i,20),c=i-20;t.textBaseline="bottom",t.font=`${n}px monospace`,t.textAlign="right",t.fillStyle="#ff3",t.fillText("Energy",l-a,c),t.textAlign="right",t.fillText(P,l-(a+6*n),c),t.textAlign="left",t.fillStyle="#888",t.font=`${.8*n}px monospace`,t.fillText("/ 6",l-(a+5.7*n),c);var d=1.2*n;for(let e=0;e<6;e++)t.fillStyle="#333",t.fillRect(l-(a+e*(4+d)+d),c-2.4*d,d,d),e<P&&(t.fillStyle="#ff3",t.fillRect(l-(a+e*(4+d)+d)+4,c-2.4*d+4,d-8,d-8));t.fillStyle="#333";e=6*(4+d)-4;t.fillRect(l-a,c-1.07*d,-e,2),t.fillStyle="#ff3",t.fillRect(l-a,c-1.07*d,-R*e,2);var g=.6*n,u=i-20;t.textBaseline="bottom",t.font=`${n}px monospace`,t.textAlign="left",t.fillStyle="#3ff",t.fillText("Shield",a,u),t.textAlign="right",t.fillText(3,a+5.3*n,u),t.textAlign="left",t.fillStyle="#888",t.font=`${.8*n}px monospace`,t.fillText("/ 3",a+5.6*n,u);for(let e=0;e<3;e++)t.fillStyle="#333",t.beginPath(),t.ellipse(a+e*(2.5*g+4)+g,u-4*g,g,g,0,0,6.28),t.fill(),e<3&&(t.fillStyle="#3ff",t.beginPath(),t.ellipse(a+e*(2.5*g+4)+g,u-4*g,g-5,g-5,0,0,6.28),t.fill());var v=w.length,y=m(l,i);for(let e=0;e<v;e++)null!=w[e]&&drawCard(t,p(e,y,l),b(i),y,w[e],S==e,1)}}function init(){bus.emit("scene",2)}function goto(e){bus.emit("scene",e)}(()=>{var l,i=e=>{l=e,bus.clear(),bus.on("scene",i),clear();var t,e=get();0==l?(e.push(new Text("SHUTTLEDECK",()=>width()/2,()=>.4*height(),"#fff",6,"center")),(t=new Text("[ Press to start ]",()=>width()/2,()=>.6*height(),"#777",3,"center")).ecs=[pulse(e=>{t.size=e},2.8,3.2,1)],e.push(t),bus.on("tap",()=>goto(2))):2==l&&e.push(new Engine)};bus.on("scene",i)})(),isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),window.addEventListener("touchstart",e=>{e.stopPropagation(),bus.emit("tap",{x:e.touches[0].clientX,y:e.touches[0].clientY})}),window.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation(),bus.emit("tap",{x:e.x,y:e.y})}),window.addEventListener("mousemove",e=>{e.preventDefault(),e.stopPropagation(),isMobile()?bus.emit("move",{x:-1,y:-1}):bus.emit("move",{x:e.x,y:e.y})}),init(),(()=>{var l=Date.now(),i=[],a=()=>{},n=()=>{var e=Date.now(),t=.001*(e-l);.3<t&&(t=.3),ctx.fillStyle="#000",ctx.fillRect(0,0,width(),height()),i.length=0,get().forEach(e=>{(e.ecs||[]).forEach(e=>e(t)),(e.update||a)(t),(e.render||a)(ctx),e.destroyed&&i.push(e)}),i.forEach(e=>remove(e)),l=e,requestAnimationFrame(n)};n()})();</script></html>
