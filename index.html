<html><meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0><style>canvas{width:100%;height:100%;}body{margin:0;background:#000;}</style><canvas><script>const canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d");var w,h;function width(){return w}function height(){return h}function resize(){canvas.width=+window.innerWidth,canvas.height=+window.innerHeight,w=canvas.width,h=canvas.height}ctx.imageSmoothingEnabled=!0,resize(),window.addEventListener("resize",resize);var g=[];function get(){return g}function add(t){g.push(t)}function remove(e){g=g.filter(t=>t!=e)}function clear(t){g=[]}function pulse(e,l,i,a){var n=0;return t=>{n+=t,e((Math.sin(n/a*6.3)+1)/2*(i-l)+l)}}function e(){var l={};return{clear:()=>l={},on:(t,e)=>(l[t]||(l[t]=[])).push(e),off:(t,e)=>l[t]=(l[t]||[]).filter(t=>t!=e),emit:(t,e)=>(l[t]||[]).forEach(t=>t(e))}}b=new e;var bus=b;function Text(t,e,l,i="#fff",a="2",n="left"){this.str=t,this.x=e,this.y=l,this.color=i,this.size=a,this.render=t=>{t.textAlign=n,t.textBaseline="middle",t.fillStyle=this.color,t.font=`${this.size}em monospace`,t.fillText(this.str,this.x(),this.y())}}function drawStars(e,l,i,a,n){var r=width(),s=height(),o=Math.sqrt(r*s)/10;e.beginPath(),e.strokeStyle="#aaa",e.fillStyle="#ddd",e.lineWidth=.5;for(let t=0;t<o;t++){var h=1+5*(.5*Math.sin(t*t*1217+t*t*t*983)+.5),f=(1234918*t*t+t*t*t*t*2291722+l*h)%r,c=(3000182*t*t*t*t+t*t*t*t*t*500291+i*h)%s;e.moveTo(f,c),e.lineTo(f+a*h,c+n*h),e.fillRect(f-1,c-1,2,2)}e.stroke()}function drawCard(e,t,l,i,a,n,r){e.save(),n&&(i*=1.04);var s=`rgba(${a.color[0]},${a.color[1]},${a.color[2]},${r})`,o=i/2,h=1.5*o;e.translate(t,l),e.fillStyle=n?`rgb(80,80,80,${.7*r})`:`rgb(50,50,50,${.7*r})`,e.fillRect(-o,-h,2*o,2*h),e.save(),e.beginPath(),e.rect(-o,-h,2*o,2*h),e.clip(),e.fillStyle=`rgba(220,230,250,${.3*r})`,e.rotate(-.3),e.translate(i/2,Date.now()%2e3/1e3*(5*i)-1.2*i),e.fillRect(2*-i,0,4*i,.2*i),e.fillRect(2*-i,.2*-i,4*i,.05*i),e.restore(),e.beginPath(),e.lineWidth=i/20,e.lineJoin="round",e.strokeStyle=s,e.moveTo(-o,-h),e.lineTo(o,-h),e.lineTo(o,h),e.lineTo(-o,h),e.closePath(),e.stroke(),e.save(),e.translate(0,.15*-i),a.glyph(e,i),e.translate(0,.52*-i),e.fillStyle=`rgba(255,255,51,${r})`;var f=.12*i;for(let t=0;t<a.cost;t++)e.fillRect((t-(a.cost-1)/2)*f-.45*f,0,.9*f,.9*f);e.restore(),e.fillStyle=s,e.textBaseline="middle",e.font=`${i/6}px monospace`,e.textAlign="center";var c=a.title;for(let t=0;t<c.length;t++)e.fillText(c[t],0,.65*h+(t-(c.length-1)/2)*h*.2);e.restore()}const cards=[{color:[255,51,51],title:["Rho","Channel"],cost:1,glyph:function(t,e){t.save(),t.lineWidth=.05*e,t.beginPath(),t.arc(0,0,e/4,0,6.29),t.stroke(),t.restore()},use:()=>{bus.emit("lane",0)}},{color:[51,255,51],title:["Gamma","Sector"],cost:1,glyph:function(t,e){t.save(),t.lineWidth=.05*e,t.beginPath(),t.arc(0,0,e/4,0,6.29),t.stroke(),t.restore()},use:()=>{bus.emit("lane",1)}},{color:[51,51,255],title:["Beta","Stream"],cost:1,glyph:function(t,e){t.save(),t.lineWidth=.05*e,t.beginPath(),t.arc(0,0,e/4,0,6.29),t.stroke(),t.restore()},use:()=>{bus.emit("lane",2)}}];function PlayedCard(e,l,i,a){var n=0;this.update=t=>{l-=500*(.5-n)*t,a+=3*a*(.5-n)*t,.5<(n+=1.2*t)&&(this.destroyed=!0)},this.render=t=>{drawCard(t,e,l,a,i,!1,2*(.5-n))}}function PullCard(l,i,a,n,e){var r=-2;this.update=t=>{1<(r+=3*t)&&(this.destroyed=!0,bus.emit("place",{slot:e,card:a}))},this.render=t=>{var e=Math.min(Math.max(r,0),1);drawCard(t,l*e*e+width()/2*(1-e*e),i*e*e+height()*(1-e*e),n*e,a,!1,e)}}function Asteroid(i,a,n){var r=100*Math.random();this.update=t=>{r+=.1*t,i.getTick()>a+6&&(this.destroyed=!0);var e=i.laneScale(),l=i.laneX(a)-i.getShipX(),t=i.laneY(n)-i.getShipY();l*l+t*t<e*e*2&&(this.destroyed=!0,bus.emit("hit",1))},this.render=e=>{e.save(),e.translate(i.laneX(a),i.laneY(n));var l=+i.laneScale();e.fillStyle="#753";for(let t=0;t<8;t++)e.beginPath(),e.arc((t+.7)*l*.3+Math.sin(3*r+t*t*4)*l*.6,Math.sin(5*r+t*t*4)*l*.7,.6*l/(+t+1),0,6.29),e.fill();e.beginPath(),e.arc(0,0,l,0,6.29),e.fill(),e.restore()}}function Engine(){var t=t=>Object.assign({},t),n=t=>t.sort(()=>Math.random()-.5),a=t=>{var e=parseInt(Math.random()*r.length),l=r[e];r.splice(e,1);var i=width(),a=height(),e=m(i,a);add(new PullCard(p(t,e,i),S(a),l,e,t)),0==r.length&&(n(r=s),s=[])},m=(t,e)=>Math.min(t*(.95/(1+i)),.185*e),p=(t,e,l)=>.5*l+(t-(i-1)/2)*e*1.17,S=t=>.735*t,r=[t(cards[0]),t(cards[0]),t(cards[0]),t(cards[1]),t(cards[1]),t(cards[1]),t(cards[2]),t(cards[2]),t(cards[2])],s=[];n(r);var i=3,b=[];for(let t=0;t<i;t++)a(t);var w=-1,e=1,x=1,T=0,P=3,M=6,R=0,E=0,$=0,A=0;const o=t=>{var e=width(),l=height(),i=t.x,a=t.y,n=-1,r=b.length,s=Math.min(e*(.95/(1+r)),.185*l);for(let t=0;t<r;t++){var o=.5*e+(t-(r-1)/2)*s*1.17,h=.735*l;o-s/2<i&&i<o+s/2&&h-3*s/4<a&&a<h+3*s/4&&(n=t)}return n};bus.on("tap",t=>{var e,l,i=o(t);0<=i&&null!=b[i]&&(cost=b[i].cost,M>=cost&&(M-=cost,b[i].use(),e=width(),l=height(),t=m(e,l),add(new PlayedCard(p(i,t,e),S(l),b[i],t)),t=i,s.push(b[t]),b[t]=null,a(i)))}),bus.on("move",t=>{w=o(t)}),bus.on("lane",t=>{e=t}),bus.on("place",({slot:t,card:e})=>{b[t]=e}),bus.on("hit",t=>{P-=t});var l=()=>{.5<Math.random()&&20<E&&add(new Asteroid(this,E,parseInt(3*Math.random())))};this.laneY=t=>{var e=height();return 0==t?.18*e:1==t?.34*e:.5*e},this.laneX=t=>{var e=width(),l=50+e/40+this.laneScale();return l+(1-(E+$-t)/5)*(e+l)},this.laneScale=()=>{var t=width(),e=height();return.3*Math.min(.16*e,t/8)},this.getTick=()=>E,this.getShipX=()=>{return 50+width()/40+this.laneScale()},this.getShipY=()=>{var t=height();return.18*t+x*t*.16},this.update=t=>{A+=t,1<($+=2*t)&&($--,E++,l()),M<6?1<=(R+=.75*t)&&(--R,M++):R=0,T+=7*(.5*(e-x)-T)*t,x+=5*(e-x)*t},this.render=e=>{var l=width(),i=height(),a=l/40,t=.16*i,n=.1*i,r=n+t,s=r+t,o=.3*Math.min(t,l/8);drawStars(e,20*-A,0,3,0);var h=n/2*.7;e.fillStyle="#446",e.fillRect(15+a,n/2,l-30-2*a,1),e.fillStyle="#446",e.beginPath(),e.arc(15+h,n/2,h,0,6.28),e.fill(),e.fillStyle="#446",e.beginPath(),e.arc(l-15-h,n/2,h,0,6.28),e.fill(),e.fillStyle="#fff";h=15+a+(E+$)/100*(l-30-2*a);e.beginPath(),e.moveTo(h+a/3,n/2),e.lineTo(h-a/3,n/2-a/3),e.lineTo(h-a/3,n/2+a/3),e.closePath(),e.fill(),e.fillStyle="#f33",e.fillRect(15,n,a,t),e.fillStyle="#3f3",e.fillRect(15,r,a,t),e.fillStyle="#33f",e.fillRect(15,s,a,t),e.fillStyle="#311",e.fillRect(l-15,n,-a,t),e.fillStyle="#131",e.fillRect(l-15,r,-a,t),e.fillStyle="#113",e.fillRect(l-15,s,-a,t),e.fillStyle="#222",e.fillRect(15,n,l-30,1),e.fillRect(15,r,l-30,1),e.fillRect(15,s,l-30,1),e.fillRect(15,s+t,l-30,1),e.save(),e.translate(50+a+o,n+t/2+x*t),e.rotate(T);for(let t=5;0<=t;t--){t<1?e.fillStyle="#fd6":t<3?e.fillStyle="#fa1":e.fillStyle="#a41",e.beginPath();var f=.2*Math.sin(A*(t+1)*20)+.5;e.arc(-o-o*t*.1,Math.sin(40*-A+t)*t*o/30,o*f/(1.5+.3*t),0,6.29),e.fill()}e.translate(Math.sin(30*A)*o/60,Math.sin(35*A)*o/40),e.fillStyle="#fff",e.beginPath(),e.moveTo(o,0),e.lineTo(.65*-o,.8*-o),e.lineTo(.65*-o,.3*-o),e.lineTo(-o,.5*-o),e.lineTo(-o,.5*o),e.lineTo(.65*-o,.3*o),e.lineTo(.65*-o,.8*o),e.closePath(),e.fill(),e.fillRect(.4*-o,.4*o,o,.15*o),e.fillRect(.4*-o,.4*-o,o,.15*-o),e.restore();var n=Math.max(.025*i,20),c=i-20;e.textBaseline="bottom",e.font=`${n}px monospace`,e.textAlign="right",e.fillStyle="#ff3",e.fillText("Energy",l-a,c),e.textAlign="right",e.fillText(M,l-(a+6*n),c),e.textAlign="left",e.fillStyle="#888",e.font=`${.8*n}px monospace`,e.fillText("/ 6",l-(a+5.7*n),c);var d=1.2*n;for(let t=0;t<6;t++)e.fillStyle="#333",e.fillRect(l-(a+t*(4+d)+d),c-2.4*d,d,d),t<M&&(e.fillStyle="#ff3",e.fillRect(l-(a+t*(4+d)+d)+4,c-2.4*d+4,d-8,d-8));e.fillStyle="#333";t=6*(4+d)-4;e.fillRect(l-a,c-1.07*d,-t,2),e.fillStyle="#ff3",e.fillRect(l-a,c-1.07*d,-R*t,2);var g=.6*n,u=i-20;e.textBaseline="bottom",e.font=`${n}px monospace`,e.textAlign="left",e.fillStyle="#3ff",e.fillText("Shield",a,u),e.textAlign="right",e.fillText(P,a+5.3*n,u),e.textAlign="left",e.fillStyle="#888",e.font=`${.8*n}px monospace`,e.fillText("/ 3",a+5.6*n,u);for(let t=0;t<3;t++)e.fillStyle="#333",e.beginPath(),e.ellipse(a+t*(2.5*g+4)+g,u-4*g,g,g,0,0,6.28),e.fill(),t<P&&(e.fillStyle="#3ff",e.beginPath(),e.ellipse(a+t*(2.5*g+4)+g,u-4*g,g-5,g-5,0,0,6.28),e.fill());var v=b.length,y=m(l,i);for(let t=0;t<v;t++)null!=b[t]&&drawCard(e,p(t,y,l),S(i),y,b[t],w==t,1)}}function init(){bus.emit("scene",2)}function goto(t){bus.emit("scene",t)}(()=>{var l,i=t=>{l=t,bus.clear(),bus.on("scene",i),clear();var e,t=get();0==l?(t.push(new Text("SHUTTLEDECK",()=>width()/2,()=>.4*height(),"#fff",6,"center")),(e=new Text("[ Press to start ]",()=>width()/2,()=>.6*height(),"#777",3,"center")).ecs=[pulse(t=>{e.size=t},2.8,3.2,1)],t.push(e),bus.on("tap",()=>goto(2))):2==l&&t.push(new Engine)};bus.on("scene",i)})(),isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),window.addEventListener("touchstart",t=>{t.stopPropagation(),bus.emit("tap",{x:t.touches[0].clientX,y:t.touches[0].clientY})}),window.addEventListener("mousedown",t=>{t.preventDefault(),t.stopPropagation(),bus.emit("tap",{x:t.x,y:t.y})}),window.addEventListener("mousemove",t=>{t.preventDefault(),t.stopPropagation(),isMobile()?bus.emit("move",{x:-1,y:-1}):bus.emit("move",{x:t.x,y:t.y})}),init(),(()=>{var l=Date.now(),i=[],a=()=>{},n=()=>{var t=Date.now(),e=.001*(t-l);.3<e&&(e=.3),ctx.fillStyle="#000",ctx.fillRect(0,0,width(),height()),i.length=0,get().forEach(t=>{(t.ecs||[]).forEach(t=>t(e)),(t.update||a)(e),(t.render||a)(ctx),t.destroyed&&i.push(t)}),i.forEach(t=>remove(t)),l=t,requestAnimationFrame(n)};n()})();</script></html>
