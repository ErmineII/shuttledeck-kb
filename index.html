<html><meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0><style>canvas{width:100%;height:100%;}body{margin:0;background:#000;}</style><canvas><script>const canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d");var w,h;function width(){return w}function height(){return h}function resize(){canvas.width=+window.innerWidth,canvas.height=+window.innerHeight,w=canvas.width,h=canvas.height}ctx.imageSmoothingEnabled=!0,ctx.lineCap="round",ctx.lineJoin="round",resize(),window.addEventListener("resize",resize);var g=[];function get(){return g}function add(e){g.push(e)}function remove(t){g=g.filter(e=>e!=t)}function clear(e){g=[]}function e(){var l={};return{clear:()=>l={},on:(e,t)=>(l[e]||(l[e]=[])).push(t),off:(e,t)=>l[e]=(l[e]||[]).filter(e=>e!=t),emit:(e,t)=>(l[e]||[]).forEach(e=>e(t))}}b=new e;var bus=b;function pulse(t,l,i,a){var r=0;return e=>{r+=e,t((Math.sin(r/a*6.3)+1)/2*(i-l)+l)}}function transition$1(t,a){var r=0;this.update=e=>{1<(r+=e/t)&&(this.destroyed=!0,bus.emit("txn-done"))},this.render=e=>{var t=width(),l=height(),i=0,i=a?Math.max(1-r*r,0):Math.pow(1.3*Math.max(r-.3,0),2);e.save(),e.fillStyle="#443",e.translate(0,.6*-l*i),e.fillRect(0,0,t,l/2),e.strokeStyle="#b94",e.fillStyle="#b94",e.lineWidth=.03*t,e.fillRect(0,l/2,t,.05*l),e.strokeRect(.25*t,.2*l,.5*t,.2*l),e.textAlign="center",e.textBaseline="middle",e.font=`${.06*t}px monospace`,e.fillText("SHUTTLEDECK",.5*t,.3*l),e.restore(),e.save(),e.fillStyle="#443",e.translate(0,.6*l*i),e.fillRect(0,l/2,t,l/2),e.fillStyle="#b94",e.fillRect(0,.55*l,t,.05*-l),e.restore()}}function drawStars(t,l,i,a,r){var n=width(),o=height(),s=Math.sqrt(n*o)/10;t.beginPath(),t.strokeStyle="#aaa",t.fillStyle="#ddd",t.lineWidth=.5;for(let e=0;e<s;e++){var h=1+5*(.5*Math.sin(e*e*1217+e*e*e*983)+.5),f=(1234918*e*e+e*e*e*e*2291722+l*h)%(n+100)-50,c=(3000182*e*e*e*e+e*e*e*e*e*500291+i*h)%(o+100)-50;t.moveTo(f,c),t.lineTo(f+a*h,c+r*h),t.fillRect(f-1,c-1,2,2)}t.stroke()}function drawCard(t,e,l,i,a,r,n){t.save(),r&&(i*=1.04);var o=`rgba(${a.color[0]},${a.color[1]},${a.color[2]},${n})`,s=i/2,h=1.5*s;t.translate(e,l),t.fillStyle=r?`rgb(80,80,80,${.7*n})`:`rgb(50,50,50,${.7*n})`,t.fillRect(-s,-h,2*s,2*h),t.save(),t.beginPath(),t.rect(-s,-h,2*s,2*h),t.clip(),t.fillStyle=`rgba(220,230,250,${.3*n})`,t.rotate(-.3),t.translate(i/2,Date.now()%2e3/1e3*(5*i)-1.2*i),t.fillRect(2*-i,0,4*i,.2*i),t.fillRect(2*-i,.2*-i,4*i,.05*i),t.restore(),t.beginPath(),t.lineWidth=i/20,t.lineJoin="round",t.strokeStyle=o,t.moveTo(-s,-h),t.lineTo(s,-h),t.lineTo(s,h),t.lineTo(-s,h),t.closePath(),t.stroke(),t.save(),t.translate(0,.15*-i),a.glyph(t,i),t.translate(0,.52*-i),t.fillStyle=`rgba(255,255,51,${n})`;var f=.12*i;for(let e=0;e<a.cost;e++)t.fillRect((e-(a.cost-1)/2)*f*1.1-.45*f,0,.9*f,.9*f);t.restore(),t.fillStyle=o,t.textBaseline="middle",t.font=`${i/6}px monospace`,t.textAlign="center";var c=a.title;for(let e=0;e<c.length;e++)t.fillText(c[e],0,.65*h+(e-(c.length-1)/2)*h*.2);t.restore()}function drawMineral(e,t,l,i,a){e.save(),e.translate(t,l),e.fillStyle="#f3f",e.rotate(i),e.fillRect(-a,-a,2*a,2*a),a*=.6,e.fillStyle="#fbf",e.fillRect(-a,-a,2*a,2*a),e.restore()}function drawShield(e,t,l,i,a){e.fillStyle="#333",e.beginPath(),e.arc(t,l,i,0,6.28),e.fill(),a&&(e.fillStyle="#3ff",e.beginPath(),e.arc(t,l,.65*i,0,6.28),e.fill())}function drawEnergy(e,t,l,i,a){e.fillStyle="#333",e.fillRect(t,l,.8*i,i),a&&(e.fillStyle="#ff3",e.fillRect(t+.175*i,l+.175*i,.45*i,.65*i))}function drawDeck(e,t,l,i){e.save(),e.strokeStyle="#ccc",e.fillStyle="#222",e.lineWidth=.1*i;var a=.5*i;e.translate(t-a,l+a),e.fillRect(-i,1.5*-i,2*i,3*i),e.strokeRect(-i,1.5*-i,2*i,3*i),e.translate(a,-a),e.fillRect(-i,1.5*-i,2*i,3*i),e.strokeRect(-i,1.5*-i,2*i,3*i),e.translate(a,-a),e.fillRect(-i,1.5*-i,2*i,3*i),e.strokeRect(-i,1.5*-i,2*i,3*i),e.restore()}function drawCharPlayer(e){var t=width(),l=height(),t=Math.min(.075*l,.1*t);e.save(),e.translate(1.2*t,l+Math.sin(.003*Date.now())*t*.1),e.fillStyle="#bbb",e.beginPath(),e.arc(.1*-t,.1*t,1.4*t,0,6.29),e.fill(),e.fillStyle="#eee",e.beginPath(),e.arc(0,1.9*-t,t,0,6.29),e.fill(),e.fillStyle="#3af",e.fillRect(.1*-t,2.1*-t,t,.4*t),e.restore()}function drawCharZoren(e){var t=width(),l=height(),i=Math.min(.075*l,.1*t);e.save(),e.translate(t-1.2*i,l+Math.sin(.0021*Date.now()+3)*i*.1),e.fillStyle="#8a8",e.fillRect(.5*-i,1.5*-i,1.4*i,2*i),e.fillStyle="#686",e.fillRect(.2*-i,1.5*-i,.1*i,2*i),e.fillRect(.35*-i,.8*-i,.1*i,.1*i),e.fillRect(.35*-i,.6*-i,.1*i,.1*i),e.fillStyle="#fdb",e.beginPath(),e.arc(0,1.8*-i,i,0,6.29),e.fill(),e.fillStyle="#333",e.fillRect(-i,1.95*-i,1.6*i,.1*i),e.fillStyle="#3b5",e.beginPath(),e.arc(.8*-i,1.8*-i,.3*i,0,6.29),e.fill(),e.beginPath(),e.arc(.1*-i,1.8*-i,.3*i,0,6.29),e.fill(),e.restore()}function drawCharWeaponTech(e){var t=width(),l=height(),i=Math.min(.075*l,.1*t);e.save(),e.translate(t-1.2*i,l+Math.sin(.0021*Date.now()+3)*i*.1),e.fillStyle="#d72",e.beginPath(),e.ellipse(.1*i,.1*i,+i,1.4*i,0,0,6.29),e.fill(),e.fillStyle="#f94",e.beginPath(),e.arc(0,1.9*-i,i,0,6.29),e.fill(),e.fillRect(.8*-i,2.3*-i,.4*i,-i),e.fillRect(.4*i,2.4*-i,.4*i,-i),e.fillStyle="#fff",e.beginPath(),e.ellipse(.3*-i,2*-i,.5*i,.3*i,0,0,6.29),e.fill(),e.fillStyle="#222",e.beginPath(),e.arc(.4*-i,2*-i,.2*i,0,6.29),e.fill(),e.restore()}function drawCharShipMech(e){var t=width(),l=height(),i=Math.min(.075*l,.1*t);e.save(),e.translate(t-1.2*i,l+Math.sin(.0021*Date.now()+3)*i*.1),e.fillStyle="#77b",e.fillRect(1.1*-i,1.5*-i,2.2*i,2*i),e.fillStyle="#669",e.fillRect(.9*i,1.5*-i,.2*i,2*i),e.fillStyle="#338",e.fillRect(.5*i,2.7*-i,.3*i,1.25*i),e.fillRect(.2*-i,2.7*-i,.1*i,.8*-i),e.fillStyle="#55a",e.fillRect(.8*-i,2.7*-i,1.3*i,1.25*i),e.fillStyle="#ff4",e.fillRect(.25*-i,3.4*-i,.2*i,.2*-i),e.fillRect(.7*-i,2.5*-i,.4*i,.2*i),e.fillRect(.2*-i,2.5*-i,.4*i,.2*i),e.restore()}function drawCharMerchant(e){var t=width(),l=height(),i=Math.min(.075*l,.1*t);e.save(),e.translate(t-1.2*i,l+Math.sin(.0021*Date.now()+3)*i*.1),e.fillStyle="#b31",e.beginPath(),e.ellipse(.4*i,.1*i,.8*i,1.8*i,0,0,6.29),e.fill(),e.fillStyle="#d74",e.beginPath(),e.arc(0,1.6*-i,.6*i,0,6.29),e.fill(),e.strokeStyle="#d74",e.beginPath(),e.lineWidth=.1*i,e.moveTo(.4*-i,2*-i),e.lineTo(.7*-i,3*-i),e.moveTo(.1*-i,2*-i),e.lineTo(.1*-i,3.2*-i),e.moveTo(.2*i,2*-i),e.lineTo(.4*i,3*-i),e.stroke(),e.fillStyle="#eee",e.beginPath(),e.arc(.7*-i,3*-i,.2*i,0,6.29),e.fill(),e.beginPath(),e.arc(.1*-i,3.2*-i,.2*i,0,6.29),e.fill(),e.beginPath(),e.arc(.4*i,3*-i,.2*i,0,6.29),e.fill(),e.fillStyle="#611",e.beginPath(),e.arc(.78*-i,3*-i,.1*i,0,6.29),e.fill(),e.beginPath(),e.arc(.18*-i,3.2*-i,.1*i,0,6.29),e.fill(),e.beginPath(),e.arc(.32*i,3*-i,.1*i,0,6.29),e.fill(),e.restore()}function drawCharSmuggler(e){var t=width(),l=height(),i=Math.min(.075*l,.1*t);e.save(),e.translate(t-1.2*i,l+Math.sin(.0021*Date.now()+3)*i*.1),e.fillStyle="#343",e.beginPath(),e.arc(.2*i,0,.6*i,0,6.29),e.fill(),e.fillStyle="#353",e.beginPath(),e.arc(.5*i,.7*-i,.6*i,0,6.29),e.fill(),e.fillStyle="#363",e.beginPath(),e.arc(.4*i,1.4*-i,.6*i,0,6.29),e.fill(),e.fillStyle="#474",e.beginPath(),e.arc(0,1.9*-i,.8*i,0,6.29),e.fill(),e.fillStyle="#3f3",e.beginPath(),e.arc(.6*-i,2.1*-i,.07*i,0,6.29),e.fill(),e.beginPath(),e.arc(.4*-i,2.08*-i,.07*i,0,6.29),e.fill(),e.beginPath(),e.arc(.65*-i,1.9*-i,.07*i,0,6.29),e.fill(),e.beginPath(),e.arc(.45*-i,1.88*-i,.07*i,0,6.29),e.fill(),e.beginPath(),e.arc(.62*-i,1.7*-i,.07*i,0,6.29),e.fill(),e.beginPath(),e.arc(.42*-i,1.68*-i,.07*i,0,6.29),e.fill(),e.restore()}function drawCharTemplar(e){var t=width(),l=height(),i=Math.min(.075*l,.1*t);e.save(),e.translate(t-1.2*i,l+Math.sin(.0021*Date.now()+3)*i*.1-.5*i),e.fillStyle="#46c",e.beginPath(),e.arc(.2*-i,1.5*-i,.4*i,0,6.29),e.fill(),e.beginPath(),e.arc(.2*i,1.4*-i,.3*i,0,6.29),e.fill(),e.fillStyle="rgba(100,100,255,0.3)",e.beginPath(),e.arc(0,.95*-i,1.1*i,-3.14,0),e.fill(),e.fillStyle="#db3",e.fillRect(1.2*-i,-i,2.4*i,.3*i),e.fillRect(.6*-i,.55*-i,1.2*i,.2*i),e.fillRect(.3*-i,.2*-i,.6*i,.1*i),e.restore()}var lineBreaks=(t,l,i)=>{var a,r,n="",o=[];for(let e=0;e<l.length;e++)n+=l[e],t.measureText(n).width>i&&(a=n.lastIndexOf(" "),r=n.substring(0,a),o.push(r.trim()),n=n.substring(a));return 0<n.trim().length&&o.push(n.trim()),o},getTextLines=(e,t,l,i,a)=>{var r=textLineMap[t];if(r&&r.w==l&&r.h==i)return r.lines;a=lineBreaks(e,t,a);return textLineMap[t]={w:l,h:i,lines:a},a},textLineMap={};function drawDialogBox(t,e,l){var i=width(),a=height(),r=Math.min(.075*a,.1*i),n=Math.max(.09*i,.08*a);t.save(),t.fillStyle="#236",t.strokeStyle="#3af",t.lineWidth=.1*r,t.beginPath(),t.moveTo(2.8*r,.75*a),t.lineTo(i-2.8*r,.75*a),t.lineTo(i-2.8*r,a-1.8*r),t.lineTo(i-2.5*r,a-1.6*r),t.lineTo(i-2.8*r,a-1.4*r),t.lineTo(i-2.8*r,a-.2*r),t.lineTo(2.8*r,a-.2*r),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#ff3",t.textAlign="left",t.font=`${.3*n}px monospace`,t.fillText(e,3*r,.75*a+.25*n),t.fillStyle="#fff",t.textAlign="left",t.font=`${.25*n}px monospace`;var o=getTextLines(t,l,i,a,i-6*r);for(let e=0;e<o.length;e++)t.fillText(o[e],3*r,.75*a+n*(2.1+e)*.3);t.restore()}function drawItemShell(e,t,l,i){e.save(),e.translate(t,l),i/=2,e.fillStyle="#333",e.strokeStyle="#666",e.lineWidth=.1*i,e.beginPath(),e.arc(0,0,i,0,6.29),e.fill(),e.stroke(),e.restore()}function drawItemXeno(e,t,l,i){e.save(),e.translate(t,l),i/=2,e.fillStyle="#ccd",e.fillRect(.07*i,.7*-i,.15*i,.7*i),e.beginPath(),e.arc(.1*i,.54*-i,.24*i,0,6.29),e.fill(),e.fillStyle="#b94",e.fillRect(.6*-i,.1*-i,1.2*i,.7*i),e.fillRect(.3*i,.3*-i,.4*i,.5*i),e.fillStyle="#aaa",e.textAlign="center",e.textBaseline="bottom",e.font=`${.2*i}px monospace`,e.fillText("Xenotransponder",0,1.4*i),e.restore()}function StartButton(){bus.on("tap",({x:e,y:t})=>{var l=width(),i=.1*l;.97*l-2*i<e&&e<.97*l&&0<t&&t<.9*i&&bus.emit("start")}),this.render=e=>{var t=width(),l=.1*t;e.save(),e.translate(.97*t-l,.02*t+.4*l);var i=Date.now()%500/500,a=.4*(1-(1-i)*(1-i))+.8;e.scale(a,1.1*a),e.strokeStyle="#0a0",e.lineWidth=.1*l*(1-i),e.strokeRect(-l,.4*-l,2*l,.8*l),e.restore(),e.fillStyle="#0a0",e.fillRect(.97*t,.02*t,2*-l,.8*l),e.fillStyle="#fff",e.font=`${.35*l}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillText("Liftoff",.97*t-l,.02*t+.4*l)}}const cards=[{color:[255,51,51],title:["Rho","Channel"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,-t/6,t/7,0,6.29),e.stroke(),e.strokeRect(-t/6,t/10,t/3,0),e.strokeRect(-t/6,t/4,t/3,0),e.restore()},use:()=>{bus.emit("lane",0)}},{color:[51,255,51],title:["Gamma","Sector"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/7,0,6.29),e.stroke(),e.strokeRect(-t/6,-t/4,t/3,0),e.strokeRect(-t/6,t/4,t/3,0),e.restore()},use:()=>{bus.emit("lane",1)}},{color:[51,51,255],title:["Beta","Stream"],cost:1,price:5,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,t/6,t/7,0,6.29),e.stroke(),e.strokeRect(-t/6,-t/10,t/3,0),e.strokeRect(-t/6,-t/4,t/3,0),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,160,30],title:["Kepler","Missile"],cost:2,price:10,glyph:function(e,t){e.save(),e.translate(t/20,0),e.rotate(.6),e.lineWidth=.05*t,e.beginPath(),e.moveTo(-t/18,-t/6),e.lineTo(0,-t/4),e.lineTo(t/18,-t/6),e.lineTo(t/18,t/4),e.lineTo(-t/18,t/4),e.closePath(),e.moveTo(-t/8,t/4),e.lineTo(-t/6,t/4),e.lineTo(-t/8,t/10),e.closePath(),e.moveTo(t/8,t/4),e.lineTo(t/6,t/4),e.lineTo(t/8,t/10),e.closePath(),e.stroke(),e.restore()},use:()=>{bus.emit("projectile",1)}},{color:[255,160,30],title:["Sigma","Cannon"],cost:3,price:20,glyph:function(e,t){e.save(),e.translate(t/12,t/15),e.rotate(.6),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.moveTo(-t/4,-t/4),e.lineTo(-t/14,-t/4),e.lineTo(-t/14,-t/10),e.lineTo(t/10,-t/10),e.lineTo(t/10,t/4),e.lineTo(-t/4,t/4),e.closePath(),e.moveTo(-t/6,0),e.lineTo(0,0),e.lineTo(-t/12,t/12),e.lineTo(0,t/6),e.lineTo(-t/6,t/6),e.stroke(),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,160,30],title:["Pulse","Breaker"],cost:3,price:25,glyph:function(e,t){e.save(),e.translate(-t/30,0),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.arc(0,0,t/16,0,6.29),e.stroke(),e.beginPath(),e.arc(0,0,t/5,-1,1),e.stroke(),e.beginPath(),e.arc(0,0,t/3,-.8,.8),e.stroke(),e.rotate(.5),e.strokeRect(-t/8,-t/30,-t/8,t/15),e.rotate(-1),e.strokeRect(-t/8,-t/30,-t/8,t/15),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,160,30],title:["Crazy","Rockets"],cost:2,price:15,glyph:function(t,l){t.save(),t.lineWidth=.05*l,t.lineCap="round";for(let e=0;e<2;e++)t.beginPath(),t.moveTo(-l/4,l/8),t.lineTo(-l/6,-l/8),t.lineTo(l/14,l/20),t.lineTo(l/8,-l/6),t.stroke(),t.beginPath(),t.moveTo(l/8+l/12,-l/6),t.lineTo(l/8-l/12,-l/6),t.lineTo(l/8,-l/6-l/8),t.closePath(),t.stroke(),t.translate(l/16,l/5),t.rotate(.2);t.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,160,30],title:["Tactical","Nuke"],cost:4,price:30,glyph:function(t,l){t.save(),t.lineWidth=.05*l,t.lineCap="round",t.beginPath(),t.arc(0,0,l/3,0,6.29),t.stroke(),t.beginPath(),t.arc(0,0,l/20,0,6.29),t.stroke(),t.rotate(.5);for(let e=0;e<3;e++)t.beginPath(),t.arc(0,0,l/4,-.4,.4,!1),t.arc(0,0,l/8,.4,-.4,!0),t.closePath(),t.stroke(),t.rotate(2.1);t.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,70,255],title:["Lane","Hopper"],cost:1,price:10,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.arc(0,t/5,t/14,0,6.29),e.stroke(),e.beginPath(),e.arc(0,0,t/14,0,6.29),e.stroke(),e.beginPath(),e.arc(0,-t/5,t/14,0,6.29),e.stroke(),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,70,255],title:["Shadow","Dash"],cost:2,price:15,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.translate(-t/20,t/10),e.rotate(.6),e.beginPath(),e.arc(0,0,t/10,0,6.29),e.stroke(),e.beginPath(),e.moveTo(0,-t/6),e.lineTo(0,-t/3),e.moveTo(0,t/6),e.lineTo(0,t/4),e.stroke(),e.beginPath(),e.moveTo(-t/12,-t/3),e.lineTo(t/12,-t/3),e.lineTo(0,-t/2),e.closePath(),e.stroke(),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,70,255],title:["Shield","Charger"],cost:3,price:25,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.arc(0,0,t/4,0,6.29),e.stroke(),e.beginPath(),e.moveTo(-t/7,0),e.lineTo(t/7,0),e.moveTo(0,-t/7),e.lineTo(0,t/7),e.stroke(),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,70,255],title:["Mineral","Siphon"],cost:3,price:20,glyph:function(t,l){t.save(),t.lineWidth=.05*l,t.lineCap="round";for(let e=0;e<3;e++)t.save(),t.translate((1-(e-1)*(e-1))*l/5,(e-1)*l/5),t.beginPath(),t.moveTo(-l/12,0),t.lineTo(0,-l/10),t.lineTo(l/12,0),t.lineTo(0,l/10),t.closePath(),t.stroke(),t.restore();t.beginPath(),t.moveTo(0,0),t.lineTo(-l/3,0),t.moveTo(-l/8,l/10),t.lineTo(-l/3,0),t.moveTo(-l/8,-l/10),t.lineTo(-l/3,0),t.stroke(),t.restore()},use:()=>{bus.emit("lane",2)}},{color:[255,70,255],title:["Hyper","Drive"],cost:4,price:25,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.beginPath(),e.moveTo(-t/6,-t/4),e.lineTo(t/6,-t/4),e.lineTo(-t/6,t/4),e.lineTo(t/6,t/4),e.closePath(),e.stroke(),e.restore()},use:()=>{bus.emit("lane",2)}},{color:[0,255,255],title:["Defense","Blessing"],cost:0,price:30,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.beginPath(),e.arc(0,0,t/3,0,6.29),e.stroke(),e.beginPath(),e.arc(0,0,t/7,0,6.29),e.stroke(),e.restore()},use:()=>{persist.setMaxShield(persist.getMaxShield()+1)}},{color:[255,255,0],title:["Strength","Blessing"],cost:0,price:30,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.translate(0,-t/10),e.strokeRect(-t/4,-t/6,t/2,.6*t),e.strokeRect(-t/10,-t/4,t/5,-t/8),e.translate(0,t/7),e.beginPath(),e.moveTo(-t/10,-t/6),e.lineTo(t/10,-t/6),e.lineTo(-t/20,0),e.lineTo(t/20,0),e.lineTo(0,t/6),e.stroke(),e.restore()},use:()=>{persist.setMaxEnergy(persist.getMaxEnergy()+1)}},{color:[200,200,200],title:["Vision","Blessing"],cost:0,price:30,glyph:function(e,t){e.save(),e.lineWidth=.05*t,e.lineCap="round",e.strokeRect(.25*-t,0,.2*t,.3*t),e.strokeRect(.05*t,0,.2*t,.3*t),e.strokeRect(.1*-t,.4*-t,.2*t,.3*t),e.restore()},use:()=>{persist.setHandSize(persist.getHandSize()+1)}}];var persist=(()=>{var t=0,l=0,i=3,a=5,r=3,n=[];return{reset:()=>{t=100,l=0,a=5,r=i=3,n=[cards[3],cards[3],cards[3],cards[3]]},getMinerals:()=>t,addMineral:e=>t+=e,getLevel:()=>l,setLevel:e=>l=e,getHandSize:()=>i,setHandSize:e=>i=e,getMaxEnergy:()=>a,setMaxEnergy:e=>a=e,getMaxShield:()=>r,setMaxShield:e=>r=e,clearDeck:e=>n=[],getDeck:()=>n,addToDeck:e=>n.push(e)}})();function Steam(l,i){var a=.4*Math.random()+.2,r=(Math.random()+1)*width()*.02,t=(Math.random()-.5)*height()*.08*r;this.update=e=>{(a-=e)<0&&(this.destroyed=!1),r+=r*a*e,i+=t*e,t-=t*e*2,l-=(Math.random()-.5)*r*e*5},this.render=e=>{var t=a;e.fillStyle=`rgba(255,255,255,${t})`,e.beginPath(),e.arc(l,i,r,0,6.29),e.fill()}}function Text(e,t,l,i="#fff",a="1",r="left"){this.str=e,this.x=t,this.y=l,this.color=i,this.size=a,this.render=e=>{var t=.08*width();e.textAlign=r,e.textBaseline="middle",e.fillStyle=this.color,e.font=`${this.size*t}px monospace`,e.fillText(this.str,this.x(),this.y())}}function MainMenu(){this.render=e=>drawStars(e,.03*-Date.now(),0,3,0),add(new Text("SHUTTLEDECK",()=>width()/2,()=>.4*height(),"#fff",1,"center"));var t=new Text("[ Press to start ]",()=>width()/2,()=>.6*height(),"#777",.5,"center");t.ecs=[pulse(e=>{t.size=e},.45,.55,1)],add(t),bus.on("tap",()=>transition(1))}function Intro(){add(new Text("Professor Zorn's Lab",()=>.03*width(),()=>.05*width(),"#fff",.5,"left")),add(new StartButton),bus.on("start",()=>transition(2)),this.render=e=>{var t=.3*height();drawCharPlayer(e),drawCharZoren(e),drawDialogBox(e,"Professor Zorn","Hey there Courier, I need your help getting this Xenotransponder to Korva-6. It's only a few planets away."),drawItemShell(e,.5*width(),.4*height(),t),drawItemXeno(e,.5*width(),.4*height(),t)}}function PlayedCard(t,l,i,a){var r=0;this.update=e=>{l-=500*(.5-r)*e,a+=3*a*(.5-r)*e,.5<(r+=1.2*e)&&(this.destroyed=!0)},this.render=e=>{drawCard(e,t,l,a,i,!1,2*(.5-r))}}function PullCard(l,i,a,r,t){var n=-.5;this.update=e=>{1<(n+=3*e)&&(this.destroyed=!0,bus.emit("place",{slot:t,card:a}))},this.render=e=>{var t=Math.min(Math.max(n,0),1);drawCard(e,l*t*t+width()/2*(1-t*t),i*t*t+height()*(1-t*t),r*t,a,!1,t)}}function Asteroid(i,t,l){var a=100*Math.random();this.x=0,this.y=0,this.obstacle=!0,this.update=e=>{a+=.1*e,this.x=i.laneX(t),this.y=i.laneY(l),i.getTick()>t+6&&(this.destroyed=!0),i.closeToShip(t,l,2)&&(this.destroyed=!0,bus.emit("hit",1))},this.render=t=>{t.save(),t.translate(this.x,this.y);var l=+i.laneScale();t.fillStyle="#963";for(let e=0;e<8;e++)t.beginPath(),t.arc((e+.7)*l*.3+Math.sin(3*a+e*e*4)*l*.6,Math.sin(5*a+e*e*4)*l*.7,.6*l/(+e+1),0,6.29),t.fill();t.beginPath(),t.arc(0,0,l,0,6.29),t.fill(),t.restore()}}function Mineral(t,l,i,e){var a=100*Math.random();this.x=0,this.y=0,this.update=e=>{a+=+e,this.x=t.laneX(l),this.y=t.laneY(i),t.getTick()>l+6&&(this.destroyed=!0),t.closeToShip(l,i,1)&&(this.destroyed=!0,bus.emit("mineral",1))},this.render=e=>{drawMineral(e,this.x,this.y,a,.4*t.laneScale())}}function Projectile(l,e,t,i,a){var r=0;this.x=e,this.y=t,this.update=e=>{r+=+e,this.x+=e*width()/2,4<r&&(this.destroyed=!0),l.collideTargets(this.x,this.y,1.5)&&(this.destroyed=!0,bus.emit("poof",{x:this.x,y:this.y,color:[255,200,100],size:1,t:.5}))},this.render=e=>{e.save();var t=l.laneScale();e.translate(this.x,this.y),1==a&&(e.fillStyle="#fff",e.fillRect(.2*-t,.2*-t,1.2*t,.4*t),e.fillRect(.4*-t,.35*-t,.4*t,.2*t),e.fillRect(.4*-t,.15*t,.4*t,.2*t),e.fillStyle="#fa3",0<Math.sin(Date.now()/14)&&e.fillRect(.3*-t,.05*-t,.8*-t,.1*t)),e.restore()}}function Poof(a,r,n,o,s,h){var f=0;this.update=e=>{h<(f+=+e)&&(this.destroyed=!0)},this.render=e=>{e.save();var t=a.laneScale();e.translate(r,n),e.beginPath();var l=1-f/h,i=.5+1.5*(1-Math.exp(-f/h*3));e.fillStyle=`rgba(${o[0]},${o[1]},${o[2]},${l})`,e.arc(0,0,s*t*i,0,6.29),e.fill(),e.restore()}}function Engine(){var r=e=>e.sort(()=>Math.random()-.5),a=e=>{var t=parseInt(Math.random()*S.length),l=S[t];S.splice(t,1);var i=width(),a=height(),t=v(i,a);add(new PullCard(b(e,t,i),m(a),l,t,e)),0==S.length&&(r(S=n),n=[])},v=(e,t)=>Math.min(e*(.95/(1+i)),.185*t),b=(e,t,l)=>.5*l+(e-(i-1)/2)*t*1.17,m=e=>.735*e,S=persist.getDeck().map(e=>Object.assign({},e)),n=[];r(S);var i=persist.getHandSize(),T=[];for(let e=0;e<i;e++)a(e);var w=-1,t=1,x=1,P=0,M=persist.getMaxShield(),R=M,k=persist.getMaxEnergy(),C=k,$=0,E=20,D=0,W=0,B=0;const o=e=>{var t=width(),l=height(),i=e.x,a=e.y,r=-1,n=T.length,o=Math.min(t*(.95/(1+n)),.185*l);for(let e=0;e<n;e++){var s=.5*t+(e-(n-1)/2)*o*1.17,h=.735*l;s-o/2<i&&i<s+o/2&&h-3*o/4<a&&a<h+3*o/4&&(r=e)}return r};bus.on("tap",e=>{var t,l,i=o(e);0<=i&&null!=T[i]&&(cost=T[i].cost,C>=cost&&(C-=cost,T[i].use(),t=width(),l=height(),e=v(t,l),add(new PlayedCard(b(i,e,t),m(l),T[i],e)),e=i,n.push(T[e]),T[e]=null,a(i)))}),bus.on("move",e=>{w=o(e)}),bus.on("lane",e=>{t=e}),bus.on("poof",({x:e,y:t,color:l,size:i,t:a})=>{add(new Poof(this,e,t,l,i,a))}),bus.on("projectile",e=>{1==e&&add(new Projectile(this,this.getShipX(),this.getShipY(),t,e))}),bus.on("place",({slot:e,card:t})=>{T[e]=t}),bus.on("hit",e=>{R-=e,bus.emit("poof",{x:this.x,y:this.y,color:[255,255,255],size:1,t:.5})}),bus.on("mineral",e=>{persist.addMineral(e)});var l=()=>{var e,t;E-7<D||(e={},0<Math.random()&&(e[t=parseInt(3*Math.random())]||(e[t]=1,add(new Asteroid(this,D,t)))),.5<Math.random()&&(e[t=parseInt(3*Math.random())]||(e[t]=1,add(new Mineral(this,D,t,1)))))};this.laneY=e=>{var t=height();return 0==e?.18*t:1==e?.34*t:.5*t},this.laneX=e=>{var t=width(),l=50+t/40+this.laneScale();return l+(1-(D+W-e)/5)*(t+l)},this.laneScale=()=>{var e=width(),t=height();return.3*Math.min(.16*t,e/8)},this.getTick=()=>D,this.getShipX=()=>{return 50+width()/40+this.laneScale()},this.getShipY=()=>{var e=height();return.18*e+x*e*.16},this.closeToShip=(e,t,l)=>{var i=this.laneScale(),e=this.laneX(e)-this.getShipX(),t=this.laneY(t)-this.getShipY();return e*e+t*t<i*i*l},this.collideTargets=(l,i,a)=>{var r=this.laneScale(),n=!1;return get().forEach(e=>{var t;!e.obstacle||(t=l-e.x)*t+(t=i-e.y)*t<r*r*a&&(n=!0,e.destroyed=!0)}),n},this.update=e=>{1<(B+=e)&&(W+=2*e),1<W&&(W--,D++,l(),E<D&&transition(3)),C<k?1<=($+=.75*e)&&(--$,C++):$=0,P+=7*(.5*(t-x)-P)*e,x+=5*(t-x)*e},this.render=t=>{var l=width(),i=height(),a=l/40,e=.16*i,r=.1*i,n=r+e,o=n+e,s=.3*Math.min(e,l/8);drawStars(t,20*-B,0,3,0);var h=.3*i;t.fillStyle="#224",t.beginPath(),t.arc(-(D+W)/5*l*.5,.34*i,h,0,6.28),t.fill(),t.beginPath(),t.arc(-(D+W-E)/5*l+.3*l,.34*i,h,0,6.28),t.fill();h=.02*i;t.fillStyle="#446",t.fillRect(15+a,r/2,l-30-2*a,1),t.fillStyle="#446",t.beginPath(),t.arc(15+h,r/2,h,0,6.28),t.fill(),t.fillStyle="#446",t.beginPath(),t.arc(l-15-h,r/2,h,0,6.28),t.fill(),t.fillStyle="#fff";h=15+a+(D+W)/(E+1)*(l-30-2*a);t.beginPath(),t.moveTo(h+a/3,r/2),t.lineTo(h-a/3,r/2-a/3),t.lineTo(h-a/3,r/2+a/3),t.closePath(),t.fill(),t.fillStyle="#f33",t.fillRect(15,r,a,e),t.fillStyle="#3f3",t.fillRect(15,n,a,e),t.fillStyle="#33f",t.fillRect(15,o,a,e),t.fillStyle="#f33",t.fillRect(l-15,r,-a,e),t.fillStyle="#3f3",t.fillRect(l-15,n,-a,e),t.fillStyle="#33f",t.fillRect(l-15,o,-a,e),t.save(),t.translate(50+a+s,r+e/2+x*e),t.rotate(P);for(let e=5;0<=e;e--){e<1?t.fillStyle="#fd6":e<3?t.fillStyle="#fa1":t.fillStyle="#a41",t.beginPath();var f=.2*Math.sin(B*(e+1)*20)+.5;t.arc(-s-s*e*.1,Math.sin(40*-B+e)*e*s/30,s*f/(1.5+.3*e),0,6.29),t.fill()}t.translate(Math.sin(30*B)*s/60,Math.sin(35*B)*s/40),t.fillStyle="#fff",t.beginPath(),t.moveTo(s,0),t.lineTo(.65*-s,.8*-s),t.lineTo(.65*-s,.3*-s),t.lineTo(-s,.5*-s),t.lineTo(-s,.5*s),t.lineTo(.65*-s,.3*s),t.lineTo(.65*-s,.8*s),t.closePath(),t.fill(),t.fillRect(.4*-s,.4*s,s,.15*s),t.fillRect(.4*-s,.4*-s,s,.15*-s),t.restore();var r=Math.min(.025*i,.035*l),c=i-r;t.textBaseline="bottom",t.font=`${r}px monospace`,t.textAlign="right",t.fillStyle="#ff3",t.fillText("Energy",l-a,c),t.textAlign="right",t.fillText(C,l-(a+6*r),c),t.textAlign="left",t.fillStyle="#888",t.font=`${.8*r}px monospace`,t.fillText(`/ ${k}`,l-(a+5.7*r),c);var d=1.2*r;for(let e=0;e<k;e++)drawEnergy(t,l-(a+e*(.8*d+4)+d),c-2.4*d,d,e<C);t.fillStyle="#333";e=(.8*d+4)*k;t.fillRect(l-a,c-1.07*d,-e,2),t.fillStyle="#ff3",t.fillRect(l-a,c-1.07*d,-$*e,2);var g=.6*r,u=i-r;t.textBaseline="bottom",t.font=`${r}px monospace`,t.textAlign="left",t.fillStyle="#3ff",t.fillText("Shield",a,u),t.textAlign="right",t.fillText(R,a+5.3*r,u),t.textAlign="left",t.fillStyle="#888",t.font=`${.8*r}px monospace`,t.fillText(`/ ${M}`,a+5.6*r,u);for(let e=0;e<M;e++)drawShield(t,a+e*(2.5*g+4)+g,u-4*g,g,e<R);e=i-r;t.textBaseline="bottom",t.font=`${r}px monospace`,t.textAlign="center",t.fillStyle="#f3f",t.fillText(persist.getMinerals(),.4*l,e),drawMineral(t,.4*l,e-2.1*r,.785,.5*r),t.fillStyle="#aaa",t.fillText(S.length,.6*l,e),drawDeck(t,.6*l,e-2.1*r,.4*r);var p=T.length,y=v(l,i);for(let e=0;e<p;e++)null!=T[e]&&drawCard(t,b(e,y,l),m(i),y,T[e],w==e,1)}}function PlanetEvent(){add(new Text("Planet: Tenadu",()=>.03*width(),()=>.05*width(),"#fff",.5,"left")),add(new StartButton),bus.on("start",()=>transition(2)),onTapCard=({x:t,y:l})=>{var i=width(),a=height(),r=persist.getMinerals(),n=Math.min(.2*a,.25*i);for(let e=0;e<f.length;e++){var o=i/2+(e-(f.length-1)/2)*i*.3;null!=f[e]&&r>=f[e].price&&o-n/2<t&&t<o+n/2&&.4*a-3*n/4<l&&l<.4*a+3*n/4&&(add(new PlayedCard(o,.4*a,f[e],n)),persist.addMineral(-f[e].price),4==s?f[e].use():persist.addToDeck(f[e]),f[e]=null)}};var s=parseInt(5*Math.random()),f=[],c="",d=drawCharWeaponTech;if(0==s){var c="Weapon Tech",d=drawCharWeaponTech,t=[cards[3],cards[4],cards[5],cards[6],cards[7]],l=parseInt(2*Math.random())+2;for(let e=0;e<l;e++)f.push(t[parseInt(Math.random()*t.length)]);bus.on("tap",onTapCard)}if(1==s){c="Ship Mechanic",d=drawCharShipMech;t=[cards[8],cards[9],cards[10],cards[11],cards[12]],l=parseInt(2*Math.random())+2;for(let e=0;e<l;e++)f.push(t[parseInt(Math.random()*t.length)]);bus.on("tap",onTapCard)}if(2==s){c="Street Merchant",d=drawCharMerchant;t=[cards[3],cards[4],cards[8],cards[9]],l=parseInt(2*Math.random())+2;for(let e=0;e<l;e++)f.push(t[parseInt(Math.random()*t.length)]);bus.on("tap",onTapCard)}if(3==s){c="Cytox Smuggler",d=drawCharSmuggler;t=[cards[5],cards[6],cards[10],cards[11]],l=parseInt(2*Math.random())+2;for(let e=0;e<l;e++)f.push(t[parseInt(Math.random()*t.length)]);bus.on("tap",onTapCard)}if(4==s){c="Neuro-Templar",d=drawCharTemplar;t=[cards[13],cards[14],cards[15]];for(let e=0;e<2;e++){var i=parseInt(Math.random()*t.length);f.push(t[i]),t.splice(i,1)}bus.on("tap",onTapCard)}this.drawCost=(e,t,l,i,a,r)=>{e.fillStyle="#f3f",e.font=`${.25*a}px monospace`,e.textAlign="left",e.textBaseline="middle";var n=.061*a,o=(e.measureText(t).width+2*n)/2;e.fillText(t,l+3*n-o,i+a),drawMineral(e,l+n/2-o,i+a,.785,.08*a),r||(e.save(),e.fillStyle="rgba(255,0,0,0.7)",e.translate(l,i+a),e.rotate(.1),e.fillRect(.5*-a,-1,a,3),e.rotate(-.2),e.fillRect(.5*-a,-1,a,3),e.restore())},this.render=t=>{var l=width(),i=height(),a=persist.getMinerals(),e=persist.getHandSize(),r=persist.getMaxEnergy(),n=persist.getMaxShield();drawCharPlayer(t),d(t),drawDialogBox(t,c,"Stop staring human! Either buy something or leave.");var o=Math.min(.04*i,.04*l);t.textAlign="left",t.textBaseline="middle",t.font=`${o}px monospace`,drawMineral(t,o,.75*i,.785,.3*o),t.fillStyle="#f3f",t.fillText(a,1.7*o,.75*i),drawDeck(t,o,.75*i-o,.2*o),t.fillStyle="#999",t.fillText(e,1.7*o,.75*i-o),drawShield(t,o,.75*i-2*o,.4*o,!0),t.fillStyle="#3ff",t.fillText(n,1.7*o,.75*i-2*o),drawEnergy(t,o-.325*o,.75*i-3.45*o,.8*o,!0),t.fillStyle="#ff3",t.fillText(r,1.7*o,.75*i-3*o);var s,h=Math.min(.2*i,.25*l);for(let e=0;e<f.length;e++)null!=f[e]&&(drawCard(t,s=l/2+(e-(f.length-1)/2)*l*.3,.4*i,h,f[e],!1,1),this.drawCost(t,`${f[e].price}`,s,.4*i,h,a>=f[e].price))}}function init(){persist.reset(),bus.emit("scene",2)}function transition(e){bus.on("txn-done",()=>{bus.emit("scene",e),add(new transition$1(1.2,!1));for(let e=0;e<width();e+=.01*width())add(new Steam(e,height()/2))}),get().forEach(e=>{e.update=void 0}),add(new transition$1(.4,!0))}(()=>{var t,l=e=>{t=e,bus.clear(),bus.on("scene",l),clear(),0==t&&add(new MainMenu),1==t&&add(new Intro),2==t&&add(new Engine),3==t&&add(new PlanetEvent)};bus.on("scene",l)})(),isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),window.addEventListener("touchstart",e=>{e.stopPropagation(),bus.emit("tap",{x:e.touches[0].clientX,y:e.touches[0].clientY})}),window.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation(),isMobile()||bus.emit("tap",{x:e.x,y:e.y})}),window.addEventListener("mousemove",e=>{e.preventDefault(),e.stopPropagation(),isMobile()?bus.emit("move",{x:-1,y:-1}):bus.emit("move",{x:e.x,y:e.y})}),init(),(()=>{var l=Date.now(),i=[],a=()=>{},r=()=>{var e=Date.now(),t=.001*(e-l);.3<t&&(t=.3),ctx.fillStyle="#000",ctx.fillRect(0,0,width(),height()),i.length=0,get().forEach(e=>{(e.ecs||[]).forEach(e=>e(t)),(e.update||a)(t),(e.render||a)(ctx),e.destroyed&&i.push(e)}),i.forEach(e=>remove(e)),l=e,requestAnimationFrame(r)};r()})();</script></html>
